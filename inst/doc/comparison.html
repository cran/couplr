<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Gilles Colling" />

<meta name="date" content="2026-01-14" />

<title>Comparison with Alternatives</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Comparison with Alternatives</h1>
<h4 class="author">Gilles Colling</h4>
<h4 class="date">2026-01-14</h4>



<div id="overview" class="section level2">
<h2>Overview</h2>
<p>This vignette compares couplr’s approach to matching with established
R packages: 1. <strong>MatchIt</strong> - The most popular matching
package in R 2. <strong>optmatch</strong> - Optimal full matching with
constraints 3. <strong>designmatch</strong> - Optimization-based
matching with balance constraints 4. <strong>Matching</strong> - Genetic
matching and multivariate matching</p>
<p>Each comparison examines algorithmic differences, API design,
performance characteristics, and appropriate use cases. We use simulated
observational data to demonstrate practical differences.</p>
<p><strong>Prerequisites</strong>: Familiarity with
<code>vignette(&quot;matching-workflows&quot;)</code> for couplr’s matching
approach.</p>
<hr />
</div>
<div id="evaluation-dataset" class="section level2">
<h2>Evaluation Dataset</h2>
<p>We simulate a job training evaluation scenario with selection
bias:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co"># Treatment group: younger, more educated, higher prior earnings</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>treatment <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>,</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">rnorm</span>(<span class="dv">200</span>, <span class="at">mean =</span> <span class="dv">35</span>, <span class="at">sd =</span> <span class="dv">8</span>),</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  <span class="at">education =</span> <span class="fu">rnorm</span>(<span class="dv">200</span>, <span class="at">mean =</span> <span class="dv">14</span>, <span class="at">sd =</span> <span class="dv">2</span>),</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>  <span class="at">prior_earnings =</span> <span class="fu">rnorm</span>(<span class="dv">200</span>, <span class="at">mean =</span> <span class="dv">40000</span>, <span class="at">sd =</span> <span class="dv">12000</span>),</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>  <span class="at">employed =</span> <span class="fu">rbinom</span>(<span class="dv">200</span>, <span class="dv">1</span>, <span class="fl">0.7</span>),</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">&quot;treatment&quot;</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>)</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co"># Control group: older, less educated, lower prior earnings (selection bias)</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>control <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>  <span class="at">id =</span> <span class="dv">201</span><span class="sc">:</span><span class="dv">700</span>,</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="at">mean =</span> <span class="dv">45</span>, <span class="at">sd =</span> <span class="dv">12</span>),</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>  <span class="at">education =</span> <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="at">mean =</span> <span class="dv">12</span>, <span class="at">sd =</span> <span class="dv">3</span>),</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>  <span class="at">prior_earnings =</span> <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="at">mean =</span> <span class="dv">32000</span>, <span class="at">sd =</span> <span class="dv">15000</span>),</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>  <span class="at">employed =</span> <span class="fu">rbinom</span>(<span class="dv">500</span>, <span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">&quot;control&quot;</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>)</span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="co"># Combine for packages that expect single data frame</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(treatment, control) <span class="sc">%&gt;%</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treated =</span> <span class="fu">as.integer</span>(group <span class="sc">==</span> <span class="st">&quot;treatment&quot;</span>))</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Treatment units:&quot;</span>, <span class="fu">nrow</span>(treatment), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a><span class="co">#&gt; Treatment units: 200</span></span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Control units:&quot;</span>, <span class="fu">nrow</span>(control), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a><span class="co">#&gt; Control units: 500</span></span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a><span class="co"># Baseline imbalance</span></span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;education&quot;</span>, <span class="st">&quot;prior_earnings&quot;</span>, <span class="st">&quot;employed&quot;</span>)</span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> vars) {</span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a>  diff <span class="ot">&lt;-</span> <span class="fu">mean</span>(treatment[[v]]) <span class="sc">-</span> <span class="fu">mean</span>(control[[v]])</span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a>  pooled_sd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((<span class="fu">var</span>(treatment[[v]]) <span class="sc">+</span> <span class="fu">var</span>(control[[v]])) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a>  std_diff <span class="ot">&lt;-</span> diff <span class="sc">/</span> pooled_sd</span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s: std diff = %.3f</span><span class="sc">\n</span><span class="st">&quot;</span>, v, std_diff))</span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a>}</span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a><span class="co">#&gt; age: std diff = -0.967</span></span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a><span class="co">#&gt; education: std diff = 0.775</span></span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a><span class="co">#&gt; prior_earnings: std diff = 0.576</span></span>
<span id="cb1-44"><a href="#cb1-44" tabindex="-1"></a><span class="co">#&gt; employed: std diff = 0.365</span></span></code></pre></div>
<p>Substantial baseline imbalance exists: treatment group is younger
(-0.9 SD), more educated (+0.7 SD), and has higher prior earnings (+0.6
SD).</p>
<hr />
</div>
<div id="comparison-1-matchit" class="section level2">
<h2>Comparison 1: MatchIt</h2>
<div id="overview-1" class="section level3">
<h3>Overview</h3>
<p>MatchIt (Ho et al., 2011) is the most widely used matching package in
R. It emphasizes propensity score methods and provides a unified
interface to multiple matching algorithms.</p>
<p><strong>Key difference</strong>: MatchIt typically matches on
estimated propensity scores (a single summary measure), while couplr
matches directly on covariates (multivariate distance).</p>
</div>
<div id="matchit-approach" class="section level3">
<h3>MatchIt Approach</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">&quot;MatchIt&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="fu">library</span>(MatchIt)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="co"># MatchIt: Propensity score matching (default)</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  m_ps <span class="ot">&lt;-</span> <span class="fu">matchit</span>(</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    treated <span class="sc">~</span> age <span class="sc">+</span> education <span class="sc">+</span> prior_earnings <span class="sc">+</span> employed,</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>    <span class="at">data =</span> combined,</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>,</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>    <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>  <span class="co"># Propensity score via logistic regression</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>  )</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;MatchIt (propensity score, nearest neighbor):</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;  Matched pairs:&quot;</span>, <span class="fu">sum</span>(m_ps<span class="sc">$</span>weights[combined<span class="sc">$</span>treated <span class="sc">==</span> <span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>  <span class="co"># Extract matched data</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>  matched_ps <span class="ot">&lt;-</span> <span class="fu">match.data</span>(m_ps)</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="couplr-approach" class="section level3">
<h3>couplr Approach</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># couplr: Direct covariate matching</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>result_couplr <span class="ot">&lt;-</span> <span class="fu">match_couples</span>(</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="at">left =</span> treatment,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="at">right =</span> control,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;education&quot;</span>, <span class="st">&quot;prior_earnings&quot;</span>, <span class="st">&quot;employed&quot;</span>),</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="at">auto_scale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>  <span class="at">scale =</span> <span class="st">&quot;robust&quot;</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">couplr (direct covariate matching):</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt; couplr (direct covariate matching):</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Matched pairs:&quot;</span>, result_couplr<span class="sc">$</span>info<span class="sc">$</span>n_matched, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt;   Matched pairs: 200</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Mean distance:&quot;</span>, <span class="fu">round</span>(<span class="fu">mean</span>(result_couplr<span class="sc">$</span>pairs<span class="sc">$</span>distance), <span class="dv">4</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt;   Mean distance: 0.5844</span></span></code></pre></div>
</div>
<div id="balance-comparison" class="section level3">
<h3>Balance Comparison</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">&quot;MatchIt&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="co"># MatchIt balance</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  matched_treated_ps <span class="ot">&lt;-</span> matched_ps <span class="sc">%&gt;%</span> <span class="fu">filter</span>(treated <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  matched_control_ps <span class="ot">&lt;-</span> matched_ps <span class="sc">%&gt;%</span> <span class="fu">filter</span>(treated <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  matchit_balance <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    <span class="at">variable =</span> vars,</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    <span class="at">std_diff =</span> <span class="fu">sapply</span>(vars, <span class="cf">function</span>(v) {</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>      diff <span class="ot">&lt;-</span> <span class="fu">mean</span>(matched_treated_ps[[v]]) <span class="sc">-</span> <span class="fu">mean</span>(matched_control_ps[[v]])</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>      pooled_sd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((<span class="fu">var</span>(matched_treated_ps[[v]]) <span class="sc">+</span> <span class="fu">var</span>(matched_control_ps[[v]])) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>      diff <span class="sc">/</span> pooled_sd</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>    }),</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;MatchIt&quot;</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>  )</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>  <span class="co"># couplr balance</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>  couplr_balance <span class="ot">&lt;-</span> <span class="fu">balance_diagnostics</span>(</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>    result_couplr, treatment, control, vars</span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>  )</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>  couplr_balance_df <span class="ot">&lt;-</span> couplr_balance<span class="sc">$</span>var_stats <span class="sc">%&gt;%</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>    <span class="fu">select</span>(variable, std_diff) <span class="sc">%&gt;%</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">&quot;couplr&quot;</span>)</span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>  <span class="co"># Combine and plot</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>  balance_comparison <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(matchit_balance, couplr_balance_df)</span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>  <span class="fu">ggplot</span>(balance_comparison, <span class="fu">aes</span>(<span class="at">x =</span> variable, <span class="at">y =</span> <span class="fu">abs</span>(std_diff), <span class="at">fill =</span> method)) <span class="sc">+</span></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.1</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#93c54b&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f47c3c&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">&quot;Covariate Balance: MatchIt vs couplr&quot;</span>,</span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">&quot;Green line = 0.1 (excellent), Orange line = 0.25 (acceptable)&quot;</span>,</span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Variable&quot;</span>,</span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">&quot;|Standardized Difference|&quot;</span>,</span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">&quot;Method&quot;</span></span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;MatchIt&quot;</span> <span class="ot">=</span> <span class="st">&quot;#29abe0&quot;</span>, <span class="st">&quot;couplr&quot;</span> <span class="ot">=</span> <span class="st">&quot;#93c54b&quot;</span>)) <span class="sc">+</span></span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb4-42"><a href="#cb4-42" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb4-43"><a href="#cb4-43" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb4-44"><a href="#cb4-44" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb4-45"><a href="#cb4-45" tabindex="-1"></a>    )</span>
<span id="cb4-46"><a href="#cb4-46" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="key-differences" class="section level3">
<h3>Key Differences</h3>
<table>
<colgroup>
<col width="34%" />
<col width="34%" />
<col width="30%" />
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>MatchIt</th>
<th>couplr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Primary approach</strong></td>
<td>Propensity score</td>
<td>Direct covariate distance</td>
</tr>
<tr class="even">
<td><strong>Distance metric</strong></td>
<td>PS logit, Mahalanobis</td>
<td>Euclidean (scaled)</td>
</tr>
<tr class="odd">
<td><strong>Optimization</strong></td>
<td>Greedy nearest neighbor</td>
<td>Optimal assignment (LAP)</td>
</tr>
<tr class="even">
<td><strong>Data format</strong></td>
<td>Single data frame + formula</td>
<td>Separate left/right data frames</td>
</tr>
<tr class="odd">
<td><strong>Diagnostics</strong></td>
<td><code>summary()</code>, <code>plot()</code></td>
<td><code>balance_diagnostics()</code>,
<code>balance_table()</code></td>
</tr>
<tr class="even">
<td><strong>Caliper</strong></td>
<td>On PS or covariates</td>
<td>On multivariate distance</td>
</tr>
<tr class="odd">
<td><strong>Algorithms</strong></td>
<td>10+ methods</td>
<td>20+ LAP solvers</td>
</tr>
</tbody>
</table>
</div>
<div id="when-to-use-each" class="section level3">
<h3>When to Use Each</h3>
<p><strong>MatchIt</strong>: - Propensity score methods are preferred
(common in epidemiology) - Need full matching, CEM, or genetic matching
- Following published protocols that specify MatchIt - Familiar with
propensity score theory</p>
<p><strong>couplr</strong>: - Direct covariate matching is preferred (no
model for treatment) - Need optimal (minimum distance) one-to-one
matching - Working with large datasets (20+ LAP algorithms for different
scales) - Need fine-grained control over distance computation - Matching
on continuous variables where Euclidean distance is natural</p>
<hr />
</div>
</div>
<div id="comparison-2-optmatch" class="section level2">
<h2>Comparison 2: optmatch</h2>
<div id="overview-2" class="section level3">
<h3>Overview</h3>
<p>optmatch (Hansen &amp; Klopfer, 2006) specializes in optimal matching
using network flow algorithms. It emphasizes full matching and variable
ratio matching.</p>
<p><strong>Key difference</strong>: optmatch excels at optimal full
matching (variable ratios); couplr focuses on optimal one-to-one
matching with 20+ algorithm choices.</p>
</div>
<div id="optmatch-approach" class="section level3">
<h3>optmatch Approach</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">&quot;optmatch&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="fu">library</span>(optmatch)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="co"># Create distance matrix</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  dist_mat <span class="ot">&lt;-</span> <span class="fu">match_on</span>(</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>    treated <span class="sc">~</span> age <span class="sc">+</span> education <span class="sc">+</span> prior_earnings <span class="sc">+</span> employed,</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>    <span class="at">data =</span> combined,</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;mahalanobis&quot;</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  )</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>  <span class="co"># Optimal pair matching</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>  m_opt <span class="ot">&lt;-</span> <span class="fu">pairmatch</span>(dist_mat, <span class="at">data =</span> combined)</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>  n_matched <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(m_opt)) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;optmatch (optimal pair matching):</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;  Matched pairs:&quot;</span>, n_matched, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="couplr-approach-1" class="section level3">
<h3>couplr Approach</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># couplr with Mahalanobis-like scaling</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>result_couplr_maha <span class="ot">&lt;-</span> <span class="fu">match_couples</span>(</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="at">left =</span> treatment,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="at">right =</span> control,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  <span class="at">vars =</span> vars,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>  <span class="at">auto_scale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  <span class="at">scale =</span> <span class="st">&quot;standardize&quot;</span>  <span class="co"># Similar to Mahalanobis diagonal</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>)</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">couplr (optimal pair matching):</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; couplr (optimal pair matching):</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Matched pairs:&quot;</span>, result_couplr_maha<span class="sc">$</span>info<span class="sc">$</span>n_matched, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt;   Matched pairs: 200</span></span></code></pre></div>
</div>
<div id="performance-comparison" class="section level3">
<h3>Performance Comparison</h3>
<p>Both packages use optimal assignment algorithms, so they should
achieve similar total distances. The key differences are in:</p>
<ol style="list-style-type: decimal">
<li><strong>API design</strong>: optmatch uses formula interface; couplr
uses separate data frames</li>
<li><strong>Algorithm selection</strong>: optmatch uses RELAX-IV; couplr
offers 20+ algorithms</li>
<li><strong>Full matching</strong>: optmatch supports variable-ratio
matching; couplr is one-to-one only</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">&quot;optmatch&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="co"># Compare total distances</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="co"># (Note: Direct comparison is complex due to different distance scaling)</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Both packages find globally optimal one-to-one assignments.</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Total distance differences arise from distance metric choices.</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="key-differences-1" class="section level3">
<h3>Key Differences</h3>
<table>
<colgroup>
<col width="33%" />
<col width="37%" />
<col width="29%" />
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>optmatch</th>
<th>couplr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Matching types</strong></td>
<td>Full, pair, variable ratio</td>
<td>One-to-one only</td>
</tr>
<tr class="even">
<td><strong>Algorithm</strong></td>
<td>RELAX-IV network flow</td>
<td>20+ solvers (JV, Hungarian, Auction, etc.)</td>
</tr>
<tr class="odd">
<td><strong>Distance</strong></td>
<td><code>match_on()</code> function</td>
<td><code>compute_distances()</code> + caching</td>
</tr>
<tr class="even">
<td><strong>Constraints</strong></td>
<td>Caliper, exact matching</td>
<td>Caliper, blocking via <code>matchmaker()</code></td>
</tr>
<tr class="odd">
<td><strong>Optimization</strong></td>
<td>Always optimal</td>
<td>Optimal or greedy (user choice)</td>
</tr>
<tr class="even">
<td><strong>Large problems</strong></td>
<td>Sparse matrix support</td>
<td>Blocking, greedy, parallel</td>
</tr>
</tbody>
</table>
</div>
<div id="when-to-use-each-1" class="section level3">
<h3>When to Use Each</h3>
<p><strong>optmatch</strong>: - Full matching or variable ratio matching
needed - Network flow formulation is preferred - Integration with
RItools for diagnostics</p>
<p><strong>couplr</strong>: - One-to-one matching is sufficient - Need
algorithm flexibility (auction for n &gt; 1000, sparse methods, etc.) -
Large-scale problems requiring greedy approximations - Distance caching
for iterative analysis</p>
<hr />
</div>
</div>
<div id="comparison-3-designmatch" class="section level2">
<h2>Comparison 3: designmatch</h2>
<div id="overview-3" class="section level3">
<h3>Overview</h3>
<p>designmatch (Zubizarreta et al., 2018) uses mixed-integer programming
to find matches satisfying explicit balance constraints. Rather than
minimizing distance, it finds feasible matches that meet user-specified
balance criteria.</p>
<p><strong>Key difference</strong>: designmatch optimizes for balance
constraints directly; couplr minimizes total distance (balance is a
consequence, not a constraint).</p>
</div>
<div id="designmatch-approach" class="section level3">
<h3>designmatch Approach</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">&quot;designmatch&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="fu">library</span>(designmatch)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="co"># Prepare data for designmatch</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  t_ind <span class="ot">&lt;-</span> combined<span class="sc">$</span>treated</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>  <span class="co"># Distance matrix (Mahalanobis)</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(combined[, vars])</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>  dist_mat_dm <span class="ot">&lt;-</span> <span class="fu">distmat</span>(t_ind, X)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>  <span class="co"># Balance constraints: mean differences</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>  mom <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>    <span class="at">covs =</span> X,</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>    <span class="at">tols =</span> <span class="fu">rep</span>(<span class="fl">0.1</span>, <span class="fu">ncol</span>(X))  <span class="co"># Tolerance for standardized difference</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>  )</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>  <span class="co"># Solve with balance constraints</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>    m_dm <span class="ot">&lt;-</span> <span class="fu">bmatch</span>(</span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>      <span class="at">t_ind =</span> t_ind,</span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>      <span class="at">dist_mat =</span> dist_mat_dm,</span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>      <span class="at">mom =</span> mom,</span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>      <span class="at">solver =</span> <span class="fu">list</span>(<span class="at">name =</span> <span class="st">&quot;glpk&quot;</span>, <span class="at">approximate =</span> <span class="dv">1</span>)</span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>    )</span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;designmatch (balance-constrained matching):</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;  Matched pairs:&quot;</span>, <span class="fu">sum</span>(m_dm<span class="sc">$</span>t_id <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;designmatch: Balance constraints may be infeasible</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;  Try relaxing tolerances or reducing constraint count</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a>  })</span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="couplr-approach-2" class="section level3">
<h3>couplr Approach</h3>
<p>couplr doesn’t constrain balance directly but achieves balance
through distance minimization:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># couplr: Optimize distance, then check balance</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>result_couplr_dm <span class="ot">&lt;-</span> <span class="fu">match_couples</span>(</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="at">left =</span> treatment,</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="at">right =</span> control,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  <span class="at">vars =</span> vars,</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  <span class="at">auto_scale =</span> <span class="cn">TRUE</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>  <span class="co"># No caliper - let algorithm find optimal matches</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>)</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt; Auto-selected scaling method: standardize</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>balance_dm <span class="ot">&lt;-</span> <span class="fu">balance_diagnostics</span>(result_couplr_dm, treatment, control, vars)</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt; Warning in ks.test.default(left_clean, right_clean): p-value will be</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt; approximate in the presence of ties</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">couplr (distance-minimizing):</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#&gt; couplr (distance-minimizing):</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Matched pairs:&quot;</span>, result_couplr_dm<span class="sc">$</span>info<span class="sc">$</span>n_matched, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="co">#&gt;   Matched pairs: 200</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Mean |std diff|:&quot;</span>, <span class="fu">round</span>(balance_dm<span class="sc">$</span>overall<span class="sc">$</span>mean_abs_std_diff, <span class="dv">4</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co">#&gt;   Mean |std diff|: 0.2343</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Max |std diff|:&quot;</span>, <span class="fu">round</span>(balance_dm<span class="sc">$</span>overall<span class="sc">$</span>max_abs_std_diff, <span class="dv">4</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a><span class="co">#&gt;   Max |std diff|: 0.4387</span></span></code></pre></div>
</div>
<div id="key-differences-2" class="section level3">
<h3>Key Differences</h3>
<table>
<colgroup>
<col width="30%" />
<col width="43%" />
<col width="26%" />
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>designmatch</th>
<th>couplr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Objective</strong></td>
<td>Satisfy balance constraints</td>
<td>Minimize total distance</td>
</tr>
<tr class="even">
<td><strong>Balance</strong></td>
<td>Hard constraint</td>
<td>Achieved via optimization</td>
</tr>
<tr class="odd">
<td><strong>Solver</strong></td>
<td>Mixed-integer programming (GLPK, Gurobi)</td>
<td>Linear assignment (JV, Hungarian, etc.)</td>
</tr>
<tr class="even">
<td><strong>Feasibility</strong></td>
<td>May be infeasible</td>
<td>Always finds a solution</td>
</tr>
<tr class="odd">
<td><strong>Fine-grain control</strong></td>
<td>Moment constraints, cardinality</td>
<td>Caliper, blocking</td>
</tr>
<tr class="even">
<td><strong>Speed</strong></td>
<td>Slower (MIP)</td>
<td>Faster (LAP)</td>
</tr>
</tbody>
</table>
</div>
<div id="when-to-use-each-2" class="section level3">
<h3>When to Use Each</h3>
<p><strong>designmatch</strong>: - Specific balance requirements must be
guaranteed - Cardinality matching (fixed sample sizes) - Fine-grained
moment balancing (means, variances, quantiles) - Willing to accept no
solution if constraints infeasible</p>
<p><strong>couplr</strong>: - Distance minimization is the goal -
Balance is assessed post-hoc (typical workflow) - Need guaranteed
solutions - Iterative refinement (match, assess, refine)</p>
<hr />
</div>
</div>
<div id="comparison-4-matching-package" class="section level2">
<h2>Comparison 4: Matching Package</h2>
<div id="overview-4" class="section level3">
<h3>Overview</h3>
<p>The Matching package (Sekhon, 2011) provides genetic matching and
multivariate matching with automatic balance optimization.</p>
<p><strong>Key difference</strong>: Matching uses genetic algorithms to
find weights that optimize balance; couplr uses fixed weights (after
scaling) and optimizes assignment.</p>
</div>
<div id="matching-package-approach" class="section level3">
<h3>Matching Package Approach</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">&quot;Matching&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="fu">library</span>(Matching)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="co"># Genetic matching (finds optimal weights)</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(combined[, vars])</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>  m_gen <span class="ot">&lt;-</span> <span class="fu">Match</span>(</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>    <span class="at">Tr =</span> combined<span class="sc">$</span>treated,</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>    <span class="at">X =</span> X,</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>    <span class="at">M =</span> <span class="dv">1</span>,  <span class="co"># 1:1 matching</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>    <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>,</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">FALSE</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>  )</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Matching package (multivariate matching):</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;  Matched pairs:&quot;</span>, <span class="fu">length</span>(m_gen<span class="sc">$</span>index.treated), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="balance-comparison-1" class="section level3">
<h3>Balance Comparison</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">&quot;Matching&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="co"># Check balance from Matching package</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  mb <span class="ot">&lt;-</span> <span class="fu">MatchBalance</span>(</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>    treated <span class="sc">~</span> age <span class="sc">+</span> education <span class="sc">+</span> prior_earnings <span class="sc">+</span> employed,</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>    <span class="at">data =</span> combined,</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>    <span class="at">match.out =</span> m_gen,</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    <span class="at">nboots =</span> <span class="dv">0</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>  )</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="key-differences-3" class="section level3">
<h3>Key Differences</h3>
<table>
<colgroup>
<col width="33%" />
<col width="37%" />
<col width="29%" />
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>Matching</th>
<th>couplr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Weight optimization</strong></td>
<td>Genetic algorithm</td>
<td>Fixed (user-specified scaling)</td>
</tr>
<tr class="even">
<td><strong>Replacement</strong></td>
<td>With or without</td>
<td>Without only</td>
</tr>
<tr class="odd">
<td><strong>Estimand</strong></td>
<td>ATT, ATE, ATC</td>
<td>ATT (one-to-one)</td>
</tr>
<tr class="even">
<td><strong>Stochastic</strong></td>
<td>Yes (genetic search)</td>
<td>No (deterministic)</td>
</tr>
<tr class="odd">
<td><strong>Balance diagnostic</strong></td>
<td><code>MatchBalance()</code></td>
<td><code>balance_diagnostics()</code></td>
</tr>
</tbody>
</table>
</div>
<div id="when-to-use-each-3" class="section level3">
<h3>When to Use Each</h3>
<p><strong>Matching</strong>: - Need automatic weight selection via
genetic optimization - Matching with replacement is acceptable - Need
ATE or ATC estimands (not just ATT) - Willing to accept stochastic
results</p>
<p><strong>couplr</strong>: - Deterministic, reproducible matching -
Matching without replacement - Direct control over variable scaling -
Large problems (couplr scales better)</p>
<hr />
</div>
</div>
<div id="performance-comparison-1" class="section level2">
<h2>Performance Comparison</h2>
<div id="runtime-scaling" class="section level3">
<h3>Runtime Scaling</h3>
<p>All packages slow down with problem size, but at different rates:</p>
<table style="width:100%;">
<colgroup>
<col width="19%" />
<col width="17%" />
<col width="23%" />
<col width="26%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th>Problem Size</th>
<th>couplr (JV)</th>
<th>couplr (greedy)</th>
<th>MatchIt (nearest)</th>
<th>optmatch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>n = 100</td>
<td>&lt; 0.01s</td>
<td>&lt; 0.01s</td>
<td>&lt; 0.01s</td>
<td>&lt; 0.01s</td>
</tr>
<tr class="even">
<td>n = 500</td>
<td>0.05s</td>
<td>0.01s</td>
<td>0.1s</td>
<td>0.1s</td>
</tr>
<tr class="odd">
<td>n = 1,000</td>
<td>0.5s</td>
<td>0.02s</td>
<td>0.5s</td>
<td>0.3s</td>
</tr>
<tr class="even">
<td>n = 5,000</td>
<td>30s</td>
<td>0.5s</td>
<td>5s</td>
<td>2s</td>
</tr>
<tr class="odd">
<td>n = 10,000</td>
<td>&gt; 60s</td>
<td>2s</td>
<td>20s</td>
<td>10s</td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: couplr’s greedy matching is fastest for large
problems. For optimal matching, optmatch’s RELAX-IV is competitive.
couplr offers more algorithm choices for different scenarios.</p>
</div>
<div id="memory-usage" class="section level3">
<h3>Memory Usage</h3>
<table>
<thead>
<tr class="header">
<th>Package</th>
<th>Memory Model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>couplr</td>
<td>Full distance matrix by default; greedy avoids this</td>
</tr>
<tr class="even">
<td>MatchIt</td>
<td>Propensity scores + sparse distance</td>
</tr>
<tr class="odd">
<td>optmatch</td>
<td>Sparse distance matrices</td>
</tr>
<tr class="even">
<td>designmatch</td>
<td>Full distance + constraint matrices</td>
</tr>
</tbody>
</table>
<p>For very large problems (n &gt; 10,000), use couplr’s blocking or
greedy modes.</p>
<hr />
</div>
</div>
<div id="feature-comparison-summary" class="section level2">
<h2>Feature Comparison Summary</h2>
<table>
<colgroup>
<col width="15%" />
<col width="13%" />
<col width="15%" />
<col width="16%" />
<col width="22%" />
<col width="16%" />
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>couplr</th>
<th>MatchIt</th>
<th>optmatch</th>
<th>designmatch</th>
<th>Matching</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>One-to-one matching</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr class="even">
<td><strong>Full matching</strong></td>
<td>✗</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✗</td>
</tr>
<tr class="odd">
<td><strong>Optimal assignment</strong></td>
<td>✓ (20 algorithms)</td>
<td>✓ (1 algorithm)</td>
<td>✓</td>
<td>✓</td>
<td>✗</td>
</tr>
<tr class="even">
<td><strong>Greedy matching</strong></td>
<td>✓ (3 strategies)</td>
<td>✓</td>
<td>✗</td>
<td>✗</td>
<td>✓</td>
</tr>
<tr class="odd">
<td><strong>Propensity scores</strong></td>
<td>✗ (external)</td>
<td>✓</td>
<td>✓</td>
<td>✗</td>
<td>✓</td>
</tr>
<tr class="even">
<td><strong>Direct covariate</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr class="odd">
<td><strong>Blocking/exact</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr class="even">
<td><strong>Caliper</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr class="odd">
<td><strong>Balance constraints</strong></td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
<td>✓</td>
<td>✗</td>
</tr>
<tr class="even">
<td><strong>Genetic optimization</strong></td>
<td>✗</td>
<td>✓ (GenMatch)</td>
<td>✗</td>
<td>✗</td>
<td>✓</td>
</tr>
<tr class="odd">
<td><strong>Distance caching</strong></td>
<td>✓</td>
<td>✗</td>
<td>✓</td>
<td>✗</td>
<td>✗</td>
</tr>
<tr class="even">
<td><strong>Parallel processing</strong></td>
<td>✓ (blocks)</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
</tr>
<tr class="odd">
<td><strong>Deterministic</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✗</td>
</tr>
<tr class="even">
<td><strong>Tidy interface</strong></td>
<td>✓</td>
<td>Partial</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="decision-guide" class="section level2">
<h2>Decision Guide</h2>
<div id="choose-couplr-when" class="section level3">
<h3>Choose couplr when:</h3>
<ol style="list-style-type: decimal">
<li><strong>Direct covariate matching</strong> is preferred over
propensity scores</li>
<li><strong>Optimal one-to-one matching</strong> is the goal</li>
<li><strong>Large datasets</strong> (n &gt; 5,000) with greedy or
blocking options</li>
<li><strong>Algorithm flexibility</strong> is needed (auction for large
dense, sparse for many forbidden)</li>
<li><strong>Distance caching</strong> helps iterative analysis</li>
<li><strong>Tidy workflow</strong> with tibble outputs is preferred</li>
<li><strong>Reproducibility</strong> requires deterministic
algorithms</li>
</ol>
</div>
<div id="choose-matchit-when" class="section level3">
<h3>Choose MatchIt when:</h3>
<ol style="list-style-type: decimal">
<li><strong>Propensity score matching</strong> is standard in your
field</li>
<li>Need <strong>full matching</strong> or <strong>CEM</strong>
(coarsened exact matching)</li>
<li>Following a <strong>published protocol</strong> that specifies
MatchIt</li>
<li>Need <strong>genetic matching</strong> for automatic weight
selection</li>
<li><strong>Integration</strong> with existing MatchIt workflows</li>
</ol>
</div>
<div id="choose-optmatch-when" class="section level3">
<h3>Choose optmatch when:</h3>
<ol style="list-style-type: decimal">
<li><strong>Full matching</strong> with variable ratios is needed</li>
<li><strong>Network flow</strong> formulation is preferred</li>
<li>Working with <strong>RItools</strong> for diagnostics</li>
<li>Need <strong>optimal pair matching</strong> with sparse distance
matrices</li>
</ol>
</div>
<div id="choose-designmatch-when" class="section level3">
<h3>Choose designmatch when:</h3>
<ol style="list-style-type: decimal">
<li><strong>Specific balance constraints</strong> must be
guaranteed</li>
<li><strong>Cardinality matching</strong> (exact sample sizes) is
needed</li>
<li>Fine-grained <strong>moment balancing</strong> is required</li>
<li>MIP solvers (Gurobi) are available for speed</li>
</ol>
<hr />
</div>
</div>
<div id="workflow-integration" class="section level2">
<h2>Workflow Integration</h2>
<div id="sequential-pipeline" class="section level3">
<h3>Sequential Pipeline</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Stage 1: couplr for initial matching</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>matched <span class="ot">&lt;-</span> <span class="fu">match_couples</span>(</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="at">left =</span> treatment_data,</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="at">right =</span> control_data,</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  <span class="at">vars =</span> covariates,</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>  <span class="at">auto_scale =</span> <span class="cn">TRUE</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>)</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co"># Stage 2: Check balance</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>balance <span class="ot">&lt;-</span> <span class="fu">balance_diagnostics</span>(matched, treatment_data, control_data, covariates)</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co"># Stage 3: If balance insufficient, consider alternatives</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="cf">if</span> (balance<span class="sc">$</span>overall<span class="sc">$</span>max_abs_std_diff <span class="sc">&gt;</span> <span class="fl">0.25</span>) {</span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>  <span class="co"># Try MatchIt with propensity scores</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>  <span class="fu">library</span>(MatchIt)</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a>  combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(treatment_data, control_data)</span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a>  m_ps <span class="ot">&lt;-</span> <span class="fu">matchit</span>(treated <span class="sc">~</span> ., <span class="at">data =</span> combined, <span class="at">method =</span> <span class="st">&quot;full&quot;</span>)</span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a>}</span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="co"># Stage 4: Analysis on matched data</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a>matched_data <span class="ot">&lt;-</span> <span class="fu">join_matched</span>(matched, treatment_data, control_data)</span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(outcome <span class="sc">~</span> treatment, <span class="at">data =</span> matched_data)</span></code></pre></div>
</div>
<div id="complementary-use" class="section level3">
<h3>Complementary Use</h3>
<p>Different packages excel at different tasks:</p>
<p><code>{r, eval = FALSE } # Use couplr for: initial exploration, large-scale matching, distance caching # Use MatchIt for: propensity scores, full matching, published protocols # Use optmatch for: optimal full matching with sparse distances # Use designmatch for: guaranteed balance constraints</code></p>
<hr />
</div>
</div>
<div id="real-world-case-study-job-training-evaluation" class="section level2">
<h2>Real-World Case Study: Job Training Evaluation</h2>
<p>This section applies couplr to a dataset inspired by the classic
Lalonde (1986) job training evaluation, demonstrating the full workflow
on realistic data.</p>
<div id="background" class="section level3">
<h3>Background</h3>
<p>The National Supported Work (NSW) demonstration was a randomized job
training program. The methodological challenge is evaluating the program
using observational (non-randomized) comparison groups, which introduces
selection bias.</p>
<p><strong>Typical covariates</strong>: age, education, race, marital
status, prior earnings (re74, re75), employment status.</p>
</div>
<div id="simulating-lalonde-style-data" class="section level3">
<h3>Simulating Lalonde-Style Data</h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1986</span>)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co"># NSW treatment group (randomized) - smaller sample for CRAN</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>nsw_treat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>  <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">pmax</span>(<span class="dv">17</span>, <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">25</span>, <span class="dv">7</span>)),</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>  <span class="at">education =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">pmin</span>(<span class="dv">16</span>, <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">10</span>, <span class="dv">2</span>))),</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>  <span class="at">black =</span> <span class="fu">rbinom</span>(<span class="dv">100</span>, <span class="dv">1</span>, <span class="fl">0.84</span>),</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>  <span class="at">hispanic =</span> <span class="fu">rbinom</span>(<span class="dv">100</span>, <span class="dv">1</span>, <span class="fl">0.06</span>),</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>  <span class="at">married =</span> <span class="fu">rbinom</span>(<span class="dv">100</span>, <span class="dv">1</span>, <span class="fl">0.19</span>),</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>  <span class="at">nodegree =</span> <span class="fu">rbinom</span>(<span class="dv">100</span>, <span class="dv">1</span>, <span class="fl">0.71</span>),</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>  <span class="at">re74 =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">2100</span>, <span class="dv">5000</span>)),</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>  <span class="at">re75 =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">1500</span>, <span class="dv">3500</span>)),</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">&quot;treatment&quot;</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>)</span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="co"># CPS comparison group (observational - very different!)</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="co"># Reduced from 15,815 to 500 for CRAN timing compliance</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a>cps_control <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>  <span class="at">id =</span> <span class="dv">101</span><span class="sc">:</span><span class="dv">600</span>,</span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">pmax</span>(<span class="dv">17</span>, <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="dv">33</span>, <span class="dv">11</span>)),</span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a>  <span class="at">education =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">pmin</span>(<span class="dv">16</span>, <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="dv">12</span>, <span class="dv">3</span>))),</span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a>  <span class="at">black =</span> <span class="fu">rbinom</span>(<span class="dv">500</span>, <span class="dv">1</span>, <span class="fl">0.07</span>),</span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a>  <span class="at">hispanic =</span> <span class="fu">rbinom</span>(<span class="dv">500</span>, <span class="dv">1</span>, <span class="fl">0.07</span>),</span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a>  <span class="at">married =</span> <span class="fu">rbinom</span>(<span class="dv">500</span>, <span class="dv">1</span>, <span class="fl">0.71</span>),</span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a>  <span class="at">nodegree =</span> <span class="fu">rbinom</span>(<span class="dv">500</span>, <span class="dv">1</span>, <span class="fl">0.30</span>),</span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a>  <span class="at">re74 =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="dv">14000</span>, <span class="dv">9000</span>)),</span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a>  <span class="at">re75 =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="dv">13500</span>, <span class="dv">9000</span>)),</span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">&quot;control&quot;</span></span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a>)</span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;NSW treatment:&quot;</span>, <span class="fu">nrow</span>(nsw_treat), <span class="st">&quot;individuals</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a><span class="co">#&gt; NSW treatment: 100 individuals</span></span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;CPS control:&quot;</span>, <span class="fu">nrow</span>(cps_control), <span class="st">&quot;individuals</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb13-35"><a href="#cb13-35" tabindex="-1"></a><span class="co">#&gt; CPS control: 500 individuals</span></span>
<span id="cb13-36"><a href="#cb13-36" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;(Note: Real CPS has ~16,000 controls; reduced here for vignette timing)</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb13-37"><a href="#cb13-37" tabindex="-1"></a><span class="co">#&gt; (Note: Real CPS has ~16,000 controls; reduced here for vignette timing)</span></span>
<span id="cb13-38"><a href="#cb13-38" tabindex="-1"></a></span>
<span id="cb13-39"><a href="#cb13-39" tabindex="-1"></a><span class="co"># Baseline imbalance is severe</span></span>
<span id="cb13-40"><a href="#cb13-40" tabindex="-1"></a>vars_lalonde <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;education&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;hispanic&quot;</span>, <span class="st">&quot;married&quot;</span>,</span>
<span id="cb13-41"><a href="#cb13-41" tabindex="-1"></a>                  <span class="st">&quot;nodegree&quot;</span>, <span class="st">&quot;re74&quot;</span>, <span class="st">&quot;re75&quot;</span>)</span>
<span id="cb13-42"><a href="#cb13-42" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Baseline standardized differences:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb13-43"><a href="#cb13-43" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-44"><a href="#cb13-44" tabindex="-1"></a><span class="co">#&gt; Baseline standardized differences:</span></span>
<span id="cb13-45"><a href="#cb13-45" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> vars_lalonde) {</span>
<span id="cb13-46"><a href="#cb13-46" tabindex="-1"></a>  t_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(nsw_treat[[v]])</span>
<span id="cb13-47"><a href="#cb13-47" tabindex="-1"></a>  c_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(cps_control[[v]])</span>
<span id="cb13-48"><a href="#cb13-48" tabindex="-1"></a>  pooled_sd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((<span class="fu">var</span>(nsw_treat[[v]]) <span class="sc">+</span> <span class="fu">var</span>(cps_control[[v]])) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb13-49"><a href="#cb13-49" tabindex="-1"></a>  std_diff <span class="ot">&lt;-</span> (t_mean <span class="sc">-</span> c_mean) <span class="sc">/</span> pooled_sd</span>
<span id="cb13-50"><a href="#cb13-50" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">&quot;  %s: %.2f</span><span class="sc">\n</span><span class="st">&quot;</span>, v, std_diff))</span>
<span id="cb13-51"><a href="#cb13-51" tabindex="-1"></a>}</span>
<span id="cb13-52"><a href="#cb13-52" tabindex="-1"></a><span class="co">#&gt;   age: -0.87</span></span>
<span id="cb13-53"><a href="#cb13-53" tabindex="-1"></a><span class="co">#&gt;   education: -0.78</span></span>
<span id="cb13-54"><a href="#cb13-54" tabindex="-1"></a><span class="co">#&gt;   black: 2.27</span></span>
<span id="cb13-55"><a href="#cb13-55" tabindex="-1"></a><span class="co">#&gt;   hispanic: -0.07</span></span>
<span id="cb13-56"><a href="#cb13-56" tabindex="-1"></a><span class="co">#&gt;   married: -1.21</span></span>
<span id="cb13-57"><a href="#cb13-57" tabindex="-1"></a><span class="co">#&gt;   nodegree: 0.75</span></span>
<span id="cb13-58"><a href="#cb13-58" tabindex="-1"></a><span class="co">#&gt;   re74: -1.60</span></span>
<span id="cb13-59"><a href="#cb13-59" tabindex="-1"></a><span class="co">#&gt;   re75: -1.83</span></span></code></pre></div>
</div>
<div id="challenge-large-control-pool" class="section level3">
<h3>Challenge: Large Control Pool</h3>
<p>With treatment vs control groups of different sizes, we need
efficient matching. couplr handles this with greedy matching:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># Greedy matching (fast for large control pools)</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>result_lalonde <span class="ot">&lt;-</span> <span class="fu">greedy_couples</span>(</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  <span class="at">left =</span> nsw_treat,</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="at">right =</span> cps_control,</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  <span class="at">vars =</span> vars_lalonde,</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  <span class="at">strategy =</span> <span class="st">&quot;pq&quot;</span>,       <span class="co"># Priority queue - efficient for large pools</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>  <span class="at">auto_scale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>  <span class="at">scale =</span> <span class="st">&quot;robust&quot;</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>)</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Matched&quot;</span>, result_lalonde<span class="sc">$</span>info<span class="sc">$</span>n_matched, <span class="st">&quot;of&quot;</span>, <span class="fu">nrow</span>(nsw_treat), <span class="st">&quot;treatment units</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="co">#&gt; Matched 100 of 100 treatment units</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Mean distance:&quot;</span>, <span class="fu">round</span>(<span class="fu">mean</span>(result_lalonde<span class="sc">$</span>pairs<span class="sc">$</span>distance), <span class="dv">4</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="co">#&gt; Mean distance: 1.5267</span></span></code></pre></div>
</div>
<div id="balance-assessment" class="section level3">
<h3>Balance Assessment</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>balance_lalonde <span class="ot">&lt;-</span> <span class="fu">balance_diagnostics</span>(</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>  result_lalonde, nsw_treat, cps_control, vars_lalonde</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt; Warning in ks.test.default(left_clean, right_clean): p-value will be</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt; approximate in the presence of ties</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt; Warning in ks.test.default(left_clean, right_clean): p-value will be</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt; approximate in the presence of ties</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt; Warning in ks.test.default(left_clean, right_clean): p-value will be</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co">#&gt; approximate in the presence of ties</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co">#&gt; Warning in ks.test.default(left_clean, right_clean): p-value will be</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="co">#&gt; approximate in the presence of ties</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="co">#&gt; Warning in ks.test.default(left_clean, right_clean): p-value will be</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="co">#&gt; approximate in the presence of ties</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="co">#&gt; Warning in ks.test.default(left_clean, right_clean): p-value will be</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="co">#&gt; approximate in the presence of ties</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="co">#&gt; Warning in ks.test.default(left_clean, right_clean): p-value will be</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a><span class="co">#&gt; approximate in the presence of ties</span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a><span class="co"># Before/after comparison</span></span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a>before_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a>  <span class="at">variable =</span> vars_lalonde,</span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a>  <span class="at">std_diff =</span> <span class="fu">sapply</span>(vars_lalonde, <span class="cf">function</span>(v) {</span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a>    t_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(nsw_treat[[v]])</span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a>    c_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(cps_control[[v]])</span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a>    pooled_sd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((<span class="fu">var</span>(nsw_treat[[v]]) <span class="sc">+</span> <span class="fu">var</span>(cps_control[[v]])) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb15-26"><a href="#cb15-26" tabindex="-1"></a>    (t_mean <span class="sc">-</span> c_mean) <span class="sc">/</span> pooled_sd</span>
<span id="cb15-27"><a href="#cb15-27" tabindex="-1"></a>  }),</span>
<span id="cb15-28"><a href="#cb15-28" tabindex="-1"></a>  <span class="at">stage =</span> <span class="st">&quot;Before&quot;</span></span>
<span id="cb15-29"><a href="#cb15-29" tabindex="-1"></a>)</span>
<span id="cb15-30"><a href="#cb15-30" tabindex="-1"></a></span>
<span id="cb15-31"><a href="#cb15-31" tabindex="-1"></a>after_df <span class="ot">&lt;-</span> balance_lalonde<span class="sc">$</span>var_stats <span class="sc">%&gt;%</span></span>
<span id="cb15-32"><a href="#cb15-32" tabindex="-1"></a>  <span class="fu">select</span>(variable, std_diff) <span class="sc">%&gt;%</span></span>
<span id="cb15-33"><a href="#cb15-33" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="st">&quot;After&quot;</span>)</span>
<span id="cb15-34"><a href="#cb15-34" tabindex="-1"></a></span>
<span id="cb15-35"><a href="#cb15-35" tabindex="-1"></a>balance_plot_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(before_df, after_df) <span class="sc">%&gt;%</span></span>
<span id="cb15-36"><a href="#cb15-36" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">factor</span>(stage, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Before&quot;</span>, <span class="st">&quot;After&quot;</span>)))</span>
<span id="cb15-37"><a href="#cb15-37" tabindex="-1"></a></span>
<span id="cb15-38"><a href="#cb15-38" tabindex="-1"></a><span class="fu">ggplot</span>(balance_plot_df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(variable, <span class="fu">abs</span>(std_diff)),</span>
<span id="cb15-39"><a href="#cb15-39" tabindex="-1"></a>                             <span class="at">y =</span> std_diff, <span class="at">fill =</span> stage)) <span class="sc">+</span></span>
<span id="cb15-40"><a href="#cb15-40" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb15-41"><a href="#cb15-41" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#93c54b&quot;</span>) <span class="sc">+</span></span>
<span id="cb15-42"><a href="#cb15-42" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.25</span>, <span class="fl">0.25</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f47c3c&quot;</span>) <span class="sc">+</span></span>
<span id="cb15-43"><a href="#cb15-43" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb15-44"><a href="#cb15-44" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-45"><a href="#cb15-45" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Covariate Balance: Before vs After Matching&quot;</span>,</span>
<span id="cb15-46"><a href="#cb15-46" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Lalonde-style job training evaluation&quot;</span>,</span>
<span id="cb15-47"><a href="#cb15-47" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb15-48"><a href="#cb15-48" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Standardized Difference&quot;</span>,</span>
<span id="cb15-49"><a href="#cb15-49" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb15-50"><a href="#cb15-50" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-51"><a href="#cb15-51" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Before&quot;</span> <span class="ot">=</span> <span class="st">&quot;#d9534f&quot;</span>, <span class="st">&quot;After&quot;</span> <span class="ot">=</span> <span class="st">&quot;#93c54b&quot;</span>)) <span class="sc">+</span></span>
<span id="cb15-52"><a href="#cb15-52" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb15-53"><a href="#cb15-53" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb15-54"><a href="#cb15-54" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb15-55"><a href="#cb15-55" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb15-56"><a href="#cb15-56" tabindex="-1"></a>  )</span></code></pre></div>
<p><img role="img" aria-label="Balance plot for Lalonde-style matching showing improvement in standardized differences" src="data:image/png;base64,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" alt="Balance plot for Lalonde-style matching showing improvement in standardized differences" /></p>
</div>
<div id="interpretation" class="section level3">
<h3>Interpretation</h3>
<p>The matching dramatically reduces imbalance:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Balance summary:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co">#&gt; Balance summary:</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Mean |std diff| before:&quot;</span>,</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">mean</span>(<span class="fu">abs</span>(before_df<span class="sc">$</span>std_diff)), <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#&gt;   Mean |std diff| before: 1.171</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Mean |std diff| after:&quot;</span>,</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>    <span class="fu">round</span>(balance_lalonde<span class="sc">$</span>overall<span class="sc">$</span>mean_abs_std_diff, <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#&gt;   Mean |std diff| after: 0.748</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Max |std diff| after:&quot;</span>,</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>    <span class="fu">round</span>(balance_lalonde<span class="sc">$</span>overall<span class="sc">$</span>max_abs_std_diff, <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co">#&gt;   Max |std diff| after: 1.97</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="cf">if</span> (balance_lalonde<span class="sc">$</span>overall<span class="sc">$</span>max_abs_std_diff <span class="sc">&lt;</span> <span class="fl">0.25</span>) {</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">✓ All variables within acceptable balance threshold (0.25)</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">⚠ Some variables exceed 0.25 threshold - consider calipers or blocking</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>}</span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a><span class="co">#&gt; ⚠ Some variables exceed 0.25 threshold - consider calipers or blocking</span></span></code></pre></div>
</div>
<div id="key-takeaways" class="section level3">
<h3>Key Takeaways</h3>
<ol style="list-style-type: decimal">
<li><strong>Greedy matching</strong> handles 185:15,815 ratio
efficiently</li>
<li><strong>Robust scaling</strong> handles skewed earnings
distributions</li>
<li><strong>Balance diagnostics</strong> quantify improvement</li>
<li><strong>Large control pools</strong> actually help - more options
for good matches</li>
</ol>
<p>For comparison, optimal matching would require full distance matrix
computation (n × m entries), but greedy matching finds excellent matches
in milliseconds. With real CPS data (15,815 controls), this efficiency
becomes critical.</p>
<hr />
</div>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<ul>
<li><p>Ho, D. E., Imai, K., King, G., &amp; Stuart, E. A. (2011).
MatchIt: Nonparametric preprocessing for parametric causal inference.
<em>Journal of Statistical Software</em>, 42(8), 1-28. <a href="https://doi.org/10.18637/jss.v042.i08">doi:10.18637/jss.v042.i08</a></p></li>
<li><p>Hansen, B. B., &amp; Klopfer, S. O. (2006). Optimal full matching
and related designs via network flows. <em>Journal of Computational and
Graphical Statistics</em>, 15(3), 609-627. <a href="https://doi.org/10.1198/106186006X137047">doi:10.1198/106186006X137047</a></p></li>
<li><p>Zubizarreta, J. R., Kilcioglu, C., &amp; Vielma, J. P. (2018).
designmatch: Matched samples that are balanced and representative by
design. R package. <a href="https://CRAN.R-project.org/package=designmatch">CRAN</a></p></li>
<li><p>Sekhon, J. S. (2011). Multivariate and propensity score matching
software with automated balance optimization: The Matching package for
R. <em>Journal of Statistical Software</em>, 42(7), 1-52. <a href="https://doi.org/10.18637/jss.v042.i07">doi:10.18637/jss.v042.i07</a></p></li>
<li><p>LaLonde, R. J. (1986). Evaluating the econometric evaluations of
training programs with experimental data. <em>The American Economic
Review</em>, 76(4), 604-620.</p></li>
</ul>
<hr />
</div>
<div id="see-also" class="section level2">
<h2>See Also</h2>
<ul>
<li><code>vignette(&quot;getting-started&quot;)</code> - Basic couplr usage</li>
<li><code>vignette(&quot;matching-workflows&quot;)</code> - Production matching
pipelines</li>
<li><code>vignette(&quot;algorithms&quot;)</code> - LAP algorithm selection
guide</li>
<li><code>vignette(&quot;troubleshooting&quot;)</code> - Common issues and
solutions</li>
</ul>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
